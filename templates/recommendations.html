{% extends "base.html" %}

{% block title %}1:1 ë§ì¶¤ ì¶”ì²œ - SKINMATE{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/recommendations.css') }}">
<style>
    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal {
        display: none; 
        position: fixed; 
        z-index: 1000; 
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto; 
        background-color: rgba(0,0,0,0.6); 
    }
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; 
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 10px;
        position: relative;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .close-button {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 25px;
        font-size: 35px;
        font-weight: bold;
    }
    .close-button:hover,
    .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    /* ìœ ì € ì •ë³´ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .user-info-card {
        background-color: #fff;
        padding: 25px;
        border-radius: 10px;
        text-align: center;
    }
    .user-info-card h3 {
        font-size: 24px;
        color: #333;
        margin-bottom: 15px;
    }
    .user-info-card p {
        font-size: 16px;
        color: #555;
        line-height: 1.6;
    }
    .user-info-card ul {
        list-style: none;
        padding: 0;
        margin: 20px 0;
    }
    .user-info-card li {
        font-size: 18px;
        color: #444;
        margin-bottom: 10px;
    }

    /* ê²°ê³¼ë³´ê¸°/ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .result-button-container {
        text-align: center;
        margin: 20px 0;
    }
    .result-button {
        display: inline-block;
        padding: 12px 25px;
        background-color: #6a0dad;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        font-weight: bold;
        transition: background-color 0.3s;
        border: none;
        cursor: pointer;
        font-family: inherit;
        font-size: 16px;
    }
    .result-button:hover {
        background-color: #4a0a8d;
    }
</style>
{% endblock %}

{% block content %}
<div class="prescription-container">

    <div class="result-button-container">
        <button id="showResultModalBtn" class="result-button">AI í”¼ë¶€ ë¶„ì„ ê²°ê³¼ ë³´ê¸°</button>
    </div>

    <div class="routine-tab-buttons">
        <button class="tab-button active" onclick="showRoutine('morning', this)">
            <img src="{{ url_for('static', filename='images/morning_icon.png') }}" alt="Morning Routine">
            <span>ëª¨ë‹ ë£¨í‹´</span>
        </button>
        <button class="tab-button" onclick="showRoutine('night', this)">
            <img src="{{ url_for('static', filename='images/night_icon.png') }}" alt="Night Routine">
            <span>ë‚˜ì´íŠ¸ ë£¨í‹´</span>
        </button>
    </div>

    <!-- ëª¨ë‹ ë£¨í‹´ -->
    {% if recommendations and recommendations.morning_routine %}
    <div id="morning" class="routine-content">
        <div class="morning-routine-section">
            <img src="{{ url_for('static', filename='images/morning_line.png') }}" class="morning_line_img">
            <div class="steps-container">
                {% for step in recommendations.morning_routine %}
                <div class="step-card">
                    <div class="step-td">
                        <div class="step-title">{{ step.step_title }}</div>
                        <div class="step-description">{{ step.step_description }}</div>
                    </div>
                    {% if step.primary_recommendation %}
                    <div class="primary-product-card">
                        <div class="product-content">
                            <div class="product-image-container">
                                {% if step.primary_recommendation.image_url %}
                                <img src="{{ step.primary_recommendation.image_url }}" alt="{{ step.primary_recommendation.name }}" class="product-image" onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/no_image.png') }}';">
                                {% else %}
                                <div class="product-image-placeholder"><span>ì´ë¯¸ì§€ ì—†ìŒ</span></div>
                                {% endif %}
                                <div class="product-rank">{{ step.primary_recommendation.rank }}ìœ„</div>
                            </div>
                            <div class="product-info">
                                <div class="product-brand">{{ step.primary_recommendation.brand }}</div>
                                <div class="product-name">{{ step.primary_recommendation.name }}</div>
                                {% if step.primary_recommendation.product_url %}
                                <a href="{{ step.primary_recommendation.product_url }}" target="_blank" class="product-link">ğŸ‘€</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if step.alternatives %}
                    <details class="alternatives-accordion">
                        <summary>ë‹¤ë¥¸ ì¢‹ì€ ì œí’ˆë“¤ë„ ìˆì–´ìš”</summary>
                        <div class="alternatives-list">
                            {% for alt_product in step.alternatives %}
                            <div class="alternative-item">
                                {% if alt_product.image_url %}
                                <img src="{{ alt_product.image_url }}" alt="{{ alt_product.name }}" class="alternative-image" onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/no_image.png') }}';">
                                {% else %}
                                <div class="alternative-image-placeholder"><span>ì´ë¯¸ì§€ ì—†ìŒ</span></div>
                                {% endif %}
                                <div class="alternative-info">
                                    <div class="alternative-brand">{{ alt_product.brand }}</div>
                                    <div class="alternative-name">{{ alt_product.name }}</div>
                                    <div class="alternative-rank">ë­í‚¹ {{ alt_product.rank }}ìœ„</div>
                                </div>
                                {% if alt_product.product_url %}
                                <a href="{{ alt_product.product_url }}" target="_blank" class="product-link small">ğŸ‘€</a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </details>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ë‚˜ì´íŠ¸ ë£¨í‹´ -->
    {% if recommendations and recommendations.night_routine %}
    <div id="night" class="routine-content" style="display:none">
        <div class="night-routine-section">
            <img src="{{ url_for('static', filename='images/night_line.png') }}" class="night_line_img">
            <div class="steps-container">
                {% for step in recommendations.night_routine %}
                <div class="step-card night">
                    <div class="step-td night">
                        <div class="step-title night">{{ step.step_title }}</div>
                        <div class="step-description night">{{ step.step_description }}</div>
                    </div>
                    {% if step.primary_recommendation %}
                    <div class="primary-product-card night">                        
                        <div class="product-content night">
                            <div class="product-image-container night">
                                {% if step.primary_recommendation.image_url %}
                                <img src="{{ step.primary_recommendation.image_url }}" alt="{{ step.primary_recommendation.name }}" class="product-image" onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/no_image.png') }}';">
                                {% else %}
                                <div class="product-image-placeholder"><span>ì´ë¯¸ì§€ ì—†ìŒ</span></div>
                                {% endif %}
                                <div class="product-rank">{{ step.primary_recommendation.rank }}ìœ„</div>
                            </div>
                            <div class="product-info">
                                <div class="product-brand">{{ step.primary_recommendation.brand }}</div>
                                <div class="product-name">{{ step.primary_recommendation.name }}</div>
                                {% if step.primary_recommendation.product_url %}
                                <a href="{{ step.primary_recommendation.product_url }}" target="_blank" class="product-link">ğŸ‘€</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if step.alternatives %}
                    <details class="alternatives-accordion">
                        <summary>ë‹¤ë¥¸ ì¢‹ì€ ì œí’ˆë“¤ë„ ìˆì–´ìš”</summary>
                        <div class="alternatives-list">
                            {% for alt_product in step.alternatives %}
                            <div class="alternative-item">
                                {% if alt_product.image_url %}
                                <img src="{{ alt_product.image_url }}" alt="{{ alt_product.name }}" class="alternative-image" onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/no_image.png') }}';">
                                {% else %}
                                <div class="alternative-image-placeholder"><span>ì´ë¯¸ì§€ ì—†ìŒ</span></div>
                                {% endif %}
                                <div class="alternative-info">
                                    <div class="alternative-brand">{{ alt_product.brand }}</div>
                                    <div class="alternative-name">{{ alt_product.name }}</div>
                                    <div class="alternative-rank">ë­í‚¹ {{ alt_product.rank }}ìœ„</div>
                                </div>
                                {% if alt_product.product_url %}
                                <a href="{{ alt_product.product_url }}" target="_blank" class="product-link small">ğŸ‘€</a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </details>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- AI ë¶„ì„ ê²°ê³¼ ëª¨ë‹¬ -->
<div id="resultModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <div class="user-info-card">
            <h3>AI í”¼ë¶€ ë¶„ì„ ê²°ê³¼</h3>
            {% if recommendations and recommendations.user_info %}
            <p><strong>{{ recommendations.user_info.username }}</strong>ë‹˜ì˜ ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
            <ul>
                <li><strong>í”¼ë¶€ íƒ€ì…:</strong> {{ recommendations.user_info.skin_type }}</li>
                <li>
                    <strong>ì£¼ìš” ê³ ë¯¼:</strong> 
                    {% if recommendations.user_info.concerns %}
                        {% for concern in recommendations.user_info.concerns %}
                            {{ concern.name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}
                        íŠ¹ë³„í•œ ê³ ë¯¼ ì—†ìŒ
                    {% endif %}
                </li>
                <li>
                    <strong>ë¶„ì„ ì‹œì  ê³„ì ˆ:</strong> 
                    {% if recommendations.user_info.season == 'summer' %} ì—¬ë¦„
                    {% elif recommendations.user_info.season == 'winter' %} ê²¨ìš¸
                    {% else %} í™˜ì ˆê¸°
                    {% endif %}
                </li>
            </ul>
            <div class="result-button-container" style="margin-top: 20px;">
                 <a href="{{ url_for('analysis') }}" class="result-button">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ê¸°ë³¸ìœ¼ë¡œ ëª¨ë‹ ë£¨í‹´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
    showRoutine('morning', document.querySelector('.tab-button.active'));

    // ëª¨ë‹¬ ê´€ë ¨ ë³€ìˆ˜
    var modal = document.getElementById("resultModal");
    var btn = document.getElementById("showResultModalBtn");
    var span = document.getElementsByClassName("close-button")[0];

    // ëª¨ë‹¬ ì—´ê¸°
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // ë‹«ê¸° ë²„íŠ¼ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    span.onclick = function() {
        modal.style.display = "none";
    }

    // ëª¨ë‹¬ ë°”ê¹¥ ì˜ì—­ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
});

function showRoutine(routineName, elmnt) {
    var i, routineContent, tabButtons;
    routineContent = document.getElementsByClassName("routine-content");
    for (i = 0; i < routineContent.length; i++) {
        routineContent[i].style.display = "none";
    }

    tabButtons = document.getElementsByClassName("tab-button");
    for (i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove("active");
    }

    document.getElementById(routineName).style.display = "block";
    if(elmnt) {
        elmnt.classList.add("active");
    }

    const mainContent = document.querySelector('main.centered-content');
    if (routineName === 'night') {
        mainContent.style.backgroundColor = '#221A46';
        mainContent.classList.add('night-theme');
    } else {
        mainContent.style.backgroundColor = '#FFFFF8';
        mainContent.classList.remove('night-theme');
    }
}
</script>
{% endblock %}